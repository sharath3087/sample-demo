name: Test File Upload to Azure

on:
  workflow_dispatch:
  push:
    branches: [main]
    paths-ignore:
      - ".github/**"
  pull_request:

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  build_codesign:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Generate timestamp in mmddyyHHMMSS format
        shell: pwsh
        run: |
          $CURRENT_DATE_TIME = Get-Date -Format "MMddyyHHmmss"
          echo "CURRENT_DATE_TIME=$CURRENT_DATE_TIME" | Out-File -FilePath $env:GITHUB_ENV -Append -Encoding utf8
          echo "Generated timestamp: $CURRENT_DATE_TIME"

      - name: Use timestamp in next step
        shell: pwsh
        run: |
          echo "Using timestamp: $env:CURRENT_DATE_TIME"
          echo "File name: backup-$env:CURRENT_DATE_TIME.zip"
